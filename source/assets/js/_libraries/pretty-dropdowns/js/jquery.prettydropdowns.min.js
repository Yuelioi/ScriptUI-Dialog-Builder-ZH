!function(e){e.fn.prettyDropdown=function(t){t=e.extend({classic:!1,customClass:"arrow",height:50,hoverIntent:200,multiDelimiter:"; ",multiVerbosity:99,selectedMarker:"&#10003;",afterLoad:function(){}},t),t.selectedMarker='<span aria-hidden="true" class="checked"> '+t.selectedMarker+"</span>",(isNaN(t.height)||t.height<8)&&(t.height=8),(isNaN(t.hoverIntent)||t.hoverIntent<0)&&(t.hoverIntent=200),isNaN(t.multiVerbosity)&&(t.multiVerbosity=99);var a,i,s,r,l,d,n="None selected",o="Selected: ",c=" selected",h=["0","1","2","3","4","5","6","7","8","9",,,,,,,,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],u=function(a){var s,r=e(a),l=a.size,n=a.name||a.id||"";if(!r.data("loaded")){if(r.data("size",l).removeAttr("size"),r.css("visibility","hidden").outerHeight(t.height),d=+new Date,a.id){var o=e("label[for="+a.id+"]");o.length&&(o.attr("id")&&!/^menu\d{13,}$/.test(o.attr("id"))?s=o.attr("id"):o.attr("id",s="menu"+d))}i=0;var c=e("optgroup, option",r),h=c.filter(":selected"),u=a.multiple,b="<ul"+(a.disabled?"":' tabindex="0"')+' role="listbox"'+(a.title?' title="'+a.title+'" aria-label="'+a.title+'"':"")+(s?' aria-labelledby="'+s+'"':"")+' aria-activedescendant="item'+d+'-1" aria-expanded="false" style="max-height:'+(t.height-2)+"px;margin:"+r.css("margin-top")+" "+r.css("margin-right")+" "+r.css("margin-bottom")+" "+r.css("margin-left")+';">';h[0]||(c[0].selected=!0,h=c.filter(":selected")),u?(b+=g(null,"selected"),c.each(function(){b+=this.selected?g(this,"",!0):g(this)})):t.classic?c.each(function(){b+=g(this)}):(b+=g(h[0],"selected"),c.filter(":not(:selected)").each(function(){b+=g(this)})),b+="</ul>",r.wrap("<div "+(n?'id="prettydropdown-'+n+'" ':"")+'class="prettydropdown '+(t.classic?"classic ":"")+(a.disabled?"disabled ":"")+(u?"multiple ":"")+t.customClass+' loading"'+(u||l>1?' style="height:'+t.height+'px;"':"")+"></div>").before(b).data("loaded",!0);var w,y=r.parent().children("ul"),x=y.outerWidth(!0);if(c=y.children(),u?k(y):t.classic&&e('[data-value="'+h.val()+'"]',y).addClass("selected").append(t.selectedMarker),y.width()<=0){var C=y.parent().clone().css({position:"absolute",top:"-100%"});e("body").append(C),x=C.children("ul").outerWidth(!0),e("li",C).width(x),w=C.children("ul").outerWidth(!0),C.remove()}c.width(x).css("width",c.css("width")).click(function(){var a=e(this),i=y.children(".selected");if(!y.parent().hasClass("disabled"))if(!y.hasClass("active")||a.hasClass("disabled")||a.hasClass("label")||a.data("value")===i.data("value")||(u?(a.children("span.checked").length?a.children("span.checked").remove():a.append(t.selectedMarker),y.children(":not(.selected)").each(function(t){e("optgroup, option",r).eq(t).prop("selected",e(this).children("span.checked").length>0)}),k(y)):(i.removeClass("selected").children("span.checked").remove(),a.addClass("selected").append(t.selectedMarker),t.classic||y.prepend(a),y.removeClass("reverse").attr("aria-activedescendant",a.attr("id")),i.data("group")&&!t.classic&&y.children(".label").filter(function(){return e(this).text()===i.data("group")}).after(i),e("optgroup, option",r).filter(function(){return this.value==a.data("value")||this.text===a.contents().filter(function(){return 3===this.nodeType}).text()}).prop("selected",!0)),r.trigger("change")),(a.hasClass("selected")||!u)&&(y.toggleClass("active"),y.attr("aria-expanded",y.hasClass("active"))),y.hasClass("active")){e(".prettydropdown > ul.active").length>1&&m(e(".prettydropdown > ul.active").not(y)[0]);var s,d=window.innerHeight,n=y.offset().top,o=document.body.scrollTop,c=y.outerHeight();l&&(s=l*(t.height-2),c-2>s&&(c=s+2));var h=n-o+c;h>d&&(n-o>d-(n-o+t.height)?(y.addClass("reverse"),t.classic||y.append(i),n-o+t.height<c&&(y.outerHeight(n-o+t.height),y.scrollTop(c))):y.height(y.height()-(h-d))),s&&s<y.height()&&y.css("height",s+"px"),t.classic&&y.scrollTop(i.index()*(t.height-2))}else y.data("clicked",!0),m(y[0])}),y.on({focusin:function(){e(window).off("keydown",v).on("keydown",v)},focusout:function(){e(window).off("keydown",v)},mouseenter:function(){y.data("hover",!0)},mouseleave:m,mousemove:f}),s&&e("#"+s).off("click",p).click(p),y.parent().width(w||y.outerWidth(!0)).removeClass("loading"),t.afterLoad()}},p=function(t){e("ul[aria-labelledby="+t.target.id+"]").focus()},v=function(i){var d=e(".prettydropdown > ul.active, .prettydropdown > ul:focus");if(d.length){if(9===i.which)return void m(d[0]);i.preventDefault(),i.stopPropagation();var n,o=d.children(),c=d.hasClass("active"),u=d.height()/(t.height-2),p=.5>u%1?Math.floor(u):Math.ceil(u);switch(s=Math.max(0,d.children(".hover").index()),r=o.length-1,a=o.eq(s),d.data("lastKeypress",+new Date),i.which){case 13:c||(a=o.filter(".selected"),b(a,1)),a.click();break;case 27:c&&m(d[0]);break;case 32:c?n=" ":(a=o.filter(".selected"),b(a,1),a.click());break;case 33:c&&(b(a,0),b(o.eq(Math.max(s-p-1,0)),1));break;case 34:c&&(b(a,0),b(o.eq(Math.min(s+p-1,r)),1));break;case 35:c&&(b(a,0),b(o.eq(r),1));break;case 36:c&&(b(a,0),b(o.eq(0),1));break;case 38:c&&(b(a,0),b(s?o.eq(s-1):o.eq(r),1));break;case 40:c&&(b(a,0),b(s===r?o.eq(0):o.eq(s+1),1));break;default:c&&(n=h[i.which-48])}if(n){clearTimeout(l),d.data("keysPressed",void 0===d.data("keysPressed")?n:d.data("keysPressed")+n),l=setTimeout(function(){d.removeData("keysPressed")},300);var v=[],f=a.index();if(o.each(function(t){0===e(this).text().toLowerCase().indexOf(d.data("keysPressed"))&&v.push(t)}),v.length)for(var g=0;g<v.length;++g){if(v[g]>f){b(o,0),b(o.eq(v[g]),1);break}g===v.length-1&&(b(o,0),b(o.eq(v[0]),1))}}}},f=function(t){var a=e(t.currentTarget);"LI"!==t.target.nodeName||!a.hasClass("active")||new Date-a.data("lastKeypress")<200||(b(a.children(),0,1),b(e(t.target),1,1))},g=function(a,s,r){var l,n="",o="";if(s=s||"",a){switch(a.nodeName){case"OPTION":"OPTGROUP"===a.parentNode.nodeName&&(n=a.parentNode.getAttribute("label")),o=(a.getAttribute("data-prefix")||"")+a.text+(a.getAttribute("data-suffix")||"");break;case"OPTGROUP":s+=" label",o=a.getAttribute("label")}(a.disabled||n&&a.parentNode.disabled)&&(s+=" disabled"),l=a.title,n&&!l&&(l=a.parentNode.title)}return++i,'<li id="item'+d+"-"+i+'"'+(n?' data-group="'+n+'"':"")+(a&&a.value?' data-value="'+a.value+'"':"")+(a&&"OPTION"===a.nodeName?' role="option"':"")+(l?' title="'+l+'" aria-label="'+l+'"':"")+(s?' class="'+e.trim(s)+'"':"")+(50!==t.height?' style="height:'+(t.height-2)+"px;line-height:"+(t.height-4)+'px;"':"")+">"+o+(r||"selected"===s?t.selectedMarker:"")+"</li>"},m=function(a){var i=e(a.currentTarget||a);"mouseleave"!==a.type||i.hasClass("active")||i.data("clicked")||(i=e(".prettydropdown > ul.active")),i.data("hover",!1),clearTimeout(l),l=setTimeout(function(){i.data("hover")||(i.hasClass("reverse")&&!t.classic&&i.prepend(i.children(":last-child")),i.removeClass("active reverse").removeData("clicked").attr("aria-expanded","false").css("height",""),i.children().removeClass("hover nohover"))},"mouseleave"!==a.type||i.data("clicked")?0:t.hoverIntent)},b=function(e,i,s){if(i){if(e.removeClass("nohover").addClass("hover"),1===e.length&&a&&!s){var l=e.parent(),d=l.outerHeight(),n=e.offset().top-l.offset().top-1;0===e.index()?l.scrollTop(0):e.index()===r?l.scrollTop(l.children().length*t.height):n+t.height>d?l.scrollTop(l.scrollTop()+t.height+n-d):0>n&&l.scrollTop(l.scrollTop()+n)}}else e.removeClass("hover").addClass("nohover")},k=function(a){var i,s=a.parent().children("select"),r=e("option",s).map(function(){return this.selected?this.text:void 0}).get();if(i=t.multiVerbosity>=r.length?r.join(t.multiDelimiter)||n:r.length+"/"+e("option",s).length+c){var l=(s.attr("title")?s.attr("title"):"")+(r.length?"\n"+o+r.join(t.multiDelimiter):"");a.children(".selected").text(i),a.attr({title:l,"aria-label":l})}else a.children(".selected").empty(),a.attr({title:s.attr("title"),"aria-label":s.attr("title")})};return this.refresh=function(t){return this.each(function(){var t=e(this);t.prevAll("ul").remove(),t.unwrap().data("loaded",!1),this.size=t.data("size"),u(this)})},this.each(function(){u(this)})}}(jQuery);